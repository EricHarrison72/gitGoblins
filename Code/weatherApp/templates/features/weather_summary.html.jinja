{% extends 'base.html.jinja' %}
{% import 'helpers/selectors.html.jinja' as selectors %}

{% block title %}
  Weather Summary
{% endblock %}

{% block header %}
  Weather Summary
{% endblock %}

{% block content %}

  <br>
  
  <div style="overflow-x: auto;">
    <table class='select-table'>
      <tr>
        <th>Location</th>
        <th>Date</th>
      </tr>
      <tr>
        <td>{{ selectors.select_single_location( url_args['city_name']) }}</td>
        <td>{{ selectors.select_date('', url_args['date']) }}</td>
        <td>
          <button onclick="reloadPageWithArgs(`city_name=${getCityFromSelection()}&date=${getDateFromSelection()}`)">
            Submit
          </button>
        </td>
      </tr>
    </table>
  </div>

  <br><br>

  <!-- Flex container for side-by-side layout -->
  <div class="flex-container">
    <div class="table-container">

      <br><br><br><br><br>
      
      <table class="select-table">
        <thead>
          <tr>
            <th>Weather Details</th>
          </tr>
        </thead>
        <tbody>
            <tr>
              <td><br>Temperature Max</td>
              <td><br>{{ weather_dict['temp_high'] }}</td>
            </tr>
            <tr>
              <td>Temperature Min</td>
              <td>{{ weather_dict['temp_low'] }}</td>
            </tr>
            <tr>
              <td>Sunshine</td>
              <td>{{ weather_dict['sunshine'] }}</td>
            </tr>
            <tr>
              <td>Rainfall</td>
              <td>{{ weather_dict['rainfall'] }}</td>
            </tr>
            <tr>
              <td>Evaporation</td>
              <td>{{ weather_dict['evaporation'] }}</td>
            </tr>
            <tr>
              <td>Cloud 9am</td>
              <td>{{ weather_dict['cloud_9am'] }}</td>
            </tr>
            <tr>
              <td>Cloud 3pm</td>
              <td>{{ weather_dict['cloud_3pm'] }}</td>
            </tr>
            <tr>
              <td>Pressure 9am</td>
              <td>{{ weather_dict['pressure_9am'] }}</td>
            </tr>
            <tr>
              <td>Pressure 3pm</td>
              <td>{{ weather_dict['pressure_3pm'] }}</td>
            </tr>
            <tr>
              <td>Humidity 9am</td>
              <td>{{ weather_dict['humidity_9am'] }}</td>
            </tr>
            <tr>
              <td>Humidity 3pm</td>
              <td>{{ weather_dict['humidity_3pm'] }}</td>
            </tr>
            <tr>
              <td>Wind Gust Speed</td>
              <td>{{ weather_dict['wind_speed'] }}</td>
            </tr>
            <tr>
              <td>Wind Gust Dir</td>
              <td>{{ weather_dict['wind_dir'] }}</td>
            </tr>
            <tr>
              <td>Wind Speed 9am</td>
              <td>{{ weather_dict['wind_speed_9am'] }}</td>
            </tr>
            <tr>
              <td>Wind Speed 3pm</td>
              <td>{{ weather_dict['wind_speed_3pm'] }}</td>
            </tr>
            <tr>
              <td>Wind Dir 9am</td>
              <td>{{ weather_dict['wind_dir_9am'] }}</td>
            </tr>
            <tr>
              <td>Wind Dir 3pm</td>
              <td>{{ weather_dict['wind_dir_3pm'] }}</td>
            </tr>
        </tbody>
      </table>
    </div>

  <div class="flex-item">
  
    <div class="centered-content">
      {% if weather_dict %}
      <font size="+3">
        <h2>{{ weather_dict['city_name'] }}</h2>
      </font>
      {% else %}
        <p>No city data found for the user.</p>
      {% endif %}

      {% if weather_icon == 'sun' %}
        <img src="{{ url_for('static', filename='img/marker_sun.png') }}" alt="Sunny" width="110" height="90">
      {% elif weather_icon == 'rain' %}
        <img src="{{ url_for('static', filename='img/marker_rain.png') }}" alt="Rainy" width="110" height="90">
      {% elif weather_icon == 'wind' %}
        <img src="{{ url_for('static', filename='img/marker_wind.png') }}" alt="Windy" width="140" height="90">
      {% elif weather_icon == 'cloud' %}
        <img src="{{ url_for('static', filename='img/marker_cloud.png') }}" alt="Cloudy" width="120" height="90"> 
      {% elif weather_icon == 'partcloud' %}
        <img src="{{ url_for('static', filename='img/marker_partcloud.png') }}" alt="Partly Cloudy" width="130" height="90">  
      {% else %}
        <img src="{{ url_for('static', filename='img/marker_error.png') }}" alt="Error" width="70" height="70">  
      {% endif %}

      <div class="table-container">
        <table class="scrollable-table">
          <tbody>
            {% if weather_dict %}

            <h4> {{ weather_dict['date'] }} </h4>

            <img src="{{ url_for('static', filename='img/temp_high.png') }}" alt="High Temperature" width="30" height="30">
            <font size="+2">{{ weather_dict['temp_high'] }}&deg &nbsp;&nbsp;&nbsp;
              
            <img src="{{ url_for('static', filename='img/temp_low.png') }}" alt="Low Temperature" width="30" height="30">  
            {{ weather_dict['temp_low'] }}&deg</font>
            <br><br>

            {% if weather_dict['rain_today'] == 'Yes' %}
              <img src="{{ url_for('static', filename='img/rain.png') }}" alt="Raining" width="30" height="30">  
            {% else %}
              <img src="{{ url_for('static', filename='img/no_rain.png') }}" alt="Not Raining" width="30" height="30">  
            {% endif %}

            &nbsp;&nbsp;&nbsp;

            {{ weather_dict['rainfall'] }} mm
              
            &nbsp;&nbsp;&nbsp;

            {% set wind_dir = weather_dict['wind_dir'] %}
            {% if wind_dir == 'E' %}
              <img src="{{ url_for('static', filename='img/arrows/E.png') }}" alt="East" width="30" height="30">
            {% elif wind_dir == 'ENE' %}
              <img src="{{ url_for('static', filename='img/arrows/ENE.png') }}" alt="East-Northeast" width="30" height="30">
            {% elif wind_dir == 'ESE' %}
              <img src="{{ url_for('static', filename='img/arrows/ESE.png') }}" alt="East-Southeast" width="30" height="30">
            {% elif wind_dir == 'N' %}
              <img src="{{ url_for('static', filename='img/arrows/N.png') }}" alt="North" width="30" height="30">
            {% elif wind_dir == 'NE' %}
              <img src="{{ url_for('static', filename='img/arrows/NE.png') }}" alt="Northeast" width="30" height="30">
            {% elif wind_dir == 'NNE' %}
              <img src="{{ url_for('static', filename='img/arrows/NNE.png') }}" alt="North-Northeast" width="30" height="30">
            {% elif wind_dir == 'NNW' %}
              <img src="{{ url_for('static', filename='img/arrows/NNW.png') }}" alt="North-Northwest" width="30" height="30">
            {% elif wind_dir == 'NW' %}
              <img src="{{ url_for('static', filename='img/arrows/NW.png') }}" alt="Northwest" width="30" height="30">
            {% elif wind_dir == 'S' %}
              <img src="{{ url_for('static', filename='img/arrows/S.png') }}" alt="South" width="30" height="30">
            {% elif wind_dir == 'SE' %}
              <img src="{{ url_for('static', filename='img/arrows/SE.png') }}" alt="Southeast" width="30" height="30">
            {% elif wind_dir == 'SSE' %}
              <img src="{{ url_for('static', filename='img/arrows/SSE.png') }}" alt="South-Southeast" width="30" height="30">
            {% elif wind_dir == 'SSW' %}
              <img src="{{ url_for('static', filename='img/arrows/SSW.png') }}" alt="South-Southwest" width="30" height="30">
            {% elif wind_dir == 'SW' %}
              <img src="{{ url_for('static', filename='img/arrows/SW.png') }}" alt="Southwest" width="30" height="30">
            {% elif wind_dir == 'W' %}
              <img src="{{ url_for('static', filename='img/arrows/W.png') }}" alt="West" width="30" height="30">
            {% elif wind_dir == 'WNW' %}
              <img src="{{ url_for('static', filename='img/arrows/WNW.png') }}" alt="West-Northwest" width="30" height="30">
            {% elif wind_dir == 'WSW' %}
              <img src="{{ url_for('static', filename='img/arrows/WSW.png') }}" alt="West-Southwest" width="30" height="30">
            {% else %}
              <img src="{{ url_for('static', filename='img/marker_error.png') }}" alt="Not Available" width="30" height="30">
            {% endif %}

              
            &nbsp;&nbsp;&nbsp;
            {{ weather_dict['wind_speed'] }}km/h

            {% else %}
              <tr>
                <td colspan="2">No weather data found for the specified date.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>

        {% if rain_prediction == 0 %}
          {% set will_or_will_not = 'WILL NOT' %}
        {% elif rain_prediction == 1 %}
          {% set will_or_will_not = 'WILL' %}
        {% else %}
          {% set error_detected = true %}
        {% endif %}

        {% if error_detected %}
          <p>There was an error while performing the AI prediction.</p>
        {% else %}
          <p>Our AI model predicts that it <b>{{ will_or_will_not }}</b> rain tomorrow.</p>
      {% endif %}
      </div>
    </div>
  
  <br>
  <br>
  
    {{ figure_html }}
  </div>
  
  </div>

{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/submit.js') }}"></script>
{% endblock %}
