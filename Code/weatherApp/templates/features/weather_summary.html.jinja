{% extends 'base.html.jinja' %}
{% import 'helpers/selectors.html.jinja' as selectors %}
{% import 'helpers/data_display.html.jinja' as display %}

{% block title %}
  Weather Summary
{% endblock %}

{% block header %}
  Weather Summary
{% endblock %}

{% block content %}
<div class="centered-content">
  <br>

  <div style="overflow-x: auto;">
    <table class='select-table'>
      <tr>
        <th>Location</th>
        <th>Date</th>
      </tr>
      <tr>
        <td>{{ selectors.select_single_location( url_args['city_name']) }}</td>
        <td>{{ selectors.select_date('', url_args['date']) }}</td>
        <td>
          <button onclick="reloadPageWithArgs(`city_name=${getCityFromSelection()}&date=${getDateFromSelection()}`)" class="dropdown-style">
            Submit
          </button>
        </td>
      </tr>
    </table>
  </div>
</div>

  <br><br>

  <!-- Flex container for side-by-side layout -->
  <div class="flex-container">
    <div class="table-container">

      
      {{ display.weather_details_table( weather_dict) }}
      
    </div>

  <div class="flex-item">
  
    <div class="centered-content">
      {% if weather_dict %}
        <h2>{{ weather_dict['city_name']|replace('BadgerysCreek', 'Badgerys Creek')|replace('MountGinini', 'Mount Ginini')|replace('NorahHead', 'Norah Head')|replace('NorfolkIsland', 'Norfolk Island')|replace('PearceRAAF', 'Pearce RAAF')|replace('MelbourneAirport', 'Melbourne Airport')|replace('SydneyAirport', 'Sydney Airport')|replace('WaggaWagga', 'Wagga Wagga')|replace('Williamtown', 'Williamtown')|replace('MountGambier', 'Mount Gambier')|replace('PerthAirport', 'Perth Airport')|replace('SalmonGums', 'Salmon Gums')|replace('AliceSprings', 'Alice Springs')|replace('GoldCoast', 'Gold Coast')|replace('SunshineCoast', 'Sunshine Coast')|replace('PortMacquarie', 'Port Macquarie')|replace('MountIsa', 'Mount Isa')|replace('CoffsHarbour', 'Coffs Harbour') }}</h2>
      {% else %}
          <p>No city data found for the user.</p>
      {% endif %}

      {% if weather_icon == 'sun' %}
        <img src="{{ url_for('static', filename='img/marker_sun.png') }}" alt="Sunny" width="80" height="65">
      {% elif weather_icon == 'rain' %}
        <img src="{{ url_for('static', filename='img/marker_rain.png') }}" alt="Rainy" width="85" height="65">
      {% elif weather_icon == 'wind' %}
        <img src="{{ url_for('static', filename='img/marker_wind.png') }}" alt="Windy" width="110" height="65">
      {% elif weather_icon == 'cloud' %}
        <img src="{{ url_for('static', filename='img/marker_cloud.png') }}" alt="Cloudy" width="90" height="65"> 
      {% elif weather_icon == 'partcloud' %}
        <img src="{{ url_for('static', filename='img/marker_partcloud.png') }}" alt="Partly Cloudy" width="100" height="65">  
      {% else %}
        <img src="{{ url_for('static', filename='img/marker_error.png') }}" alt="Error" width="50" height="50">  
      {% endif %}

      <div class="table-container">
        <table class="scrollable-table">
          <tbody>
            {% if weather_dict %}

            <h4> {{ weather_dict['date'] }} </h4>
            
            <div class="weather-detail">
              <img src="{{ url_for('static', filename='img/temp_high.png') }}" alt="High Temperature" width="25" height="25">
              <div>High</div>
            </div>
            <font size="+2">{{ weather_dict['temp_high'] }}&deg</font>C
              
            &nbsp;&nbsp;&nbsp;
              
            <div class="weather-detail">
              <img src="{{ url_for('static', filename='img/temp_low.png') }}" alt="Low Temperature" width="25" height="25">
              <div>Low</div>
            </div>
            <font size="+2">{{ weather_dict['temp_low'] }}&deg</font>C
            
            <br><br>

            <div class="weather-detail">
            {% if weather_dict['rain_today'] == 'Yes' %}
              <img src="{{ url_for('static', filename='img/rain.png') }}" alt="Raining" width="25" height="25">  
            {% else %}
              <img src="{{ url_for('static', filename='img/no_rain.png') }}" alt="Not Raining" width="25" height="25">  
            {% endif %}
            <div>Rain</div>
            </div>

            &nbsp;&nbsp;&nbsp;

            {{ weather_dict['rainfall'] }} mm
              
            &nbsp;&nbsp;&nbsp;

            <div class="weather-detail">
            {% set wind_dir = weather_dict['wind_dir'] %}
            {% if wind_dir == 'E' %}
              <img src="{{ url_for('static', filename='img/arrows/E.png') }}" alt="East" width="25" height="15">
            {% elif wind_dir == 'ENE' %}
              <img src="{{ url_for('static', filename='img/arrows/ENE.png') }}" alt="East-Northeast" width="25" height="25">
            {% elif wind_dir == 'ESE' %}
              <img src="{{ url_for('static', filename='img/arrows/ESE.png') }}" alt="East-Southeast" width="25" height="25">
            {% elif wind_dir == 'N' %}
              <img src="{{ url_for('static', filename='img/arrows/N.png') }}" alt="North" width="15" height="25">
            {% elif wind_dir == 'NE' %}
              <img src="{{ url_for('static', filename='img/arrows/NE.png') }}" alt="Northeast" width="25" height="25">
            {% elif wind_dir == 'NNE' %}
              <img src="{{ url_for('static', filename='img/arrows/NNE.png') }}" alt="North-Northeast" width="20" height="25">
            {% elif wind_dir == 'NNW' %}
              <img src="{{ url_for('static', filename='img/arrows/NNW.png') }}" alt="North-Northwest" width="20" height="25">
            {% elif wind_dir == 'NW' %}
              <img src="{{ url_for('static', filename='img/arrows/NW.png') }}" alt="Northwest" width="25" height="25">
            {% elif wind_dir == 'S' %}
              <img src="{{ url_for('static', filename='img/arrows/S.png') }}" alt="South" width="15" height="25">
            {% elif wind_dir == 'SE' %}
              <img src="{{ url_for('static', filename='img/arrows/SE.png') }}" alt="Southeast" width="25" height="25">
            {% elif wind_dir == 'SSE' %}
              <img src="{{ url_for('static', filename='img/arrows/SSE.png') }}" alt="South-Southeast" width="20" height="25">
            {% elif wind_dir == 'SSW' %}
              <img src="{{ url_for('static', filename='img/arrows/SSW.png') }}" alt="South-Southwest" width="20" height="25">
            {% elif wind_dir == 'SW' %}
              <img src="{{ url_for('static', filename='img/arrows/SW.png') }}" alt="Southwest" width="25" height="25">
            {% elif wind_dir == 'W' %}
              <img src="{{ url_for('static', filename='img/arrows/W.png') }}" alt="West" width="25" height="15">
            {% elif wind_dir == 'WNW' %}
              <img src="{{ url_for('static', filename='img/arrows/WNW.png') }}" alt="West-Northwest" width="25" height="25">
            {% elif wind_dir == 'WSW' %}
              <img src="{{ url_for('static', filename='img/arrows/WSW.png') }}" alt="West-Southwest" width="25" height="25">
            {% else %}
              <img src="{{ url_for('static', filename='img/marker_error.png') }}" alt="Not Available" width="25" height="25">
            {% endif %}
            <div>Wind</div>
          </div>
              
            &nbsp;&nbsp;&nbsp;
            {{ weather_dict['wind_speed'] }} km/h

            {% else %}
              <tr>
                <td colspan="2">No weather data found for the specified date.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>

        {% if rain_prediction == 0 %}
          {% set will_or_will_not = 'WILL NOT' %}
        {% elif rain_prediction == 1 %}
          {% set will_or_will_not = 'WILL' %}
        {% else %}
          {% set error_detected = true %}
        {% endif %}

        {% if error_detected %}
          <p>There was an error while performing the AI prediction.</p>
        {% else %}
          <p>Our AI model predicts that it <b>{{ will_or_will_not }}</b> rain tomorrow.</p>
      {% endif %}
      </div>
    </div>
    
    <br>
    <br>

    {{ figure_html }}
  
  </div>  
</div>

{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/submit.js') }}"></script>
{% endblock %}
